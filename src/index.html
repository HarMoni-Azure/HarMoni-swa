<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT 헬스케어 모니터링 대시보드</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;
        }
        
        body {
            background-color: #f3f4f6;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 280px;
            background: white;
            box-shadow: 2px 0 8px rgba(0,0,0,0.1);
            overflow-y: auto;
            z-index: 1000;
        }
        
        .main-content {
            margin-left: 280px;
            padding: 20px;
        }
        
        .header {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-radius: 8px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 4px solid;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        
        .patient-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid #e5e7eb;
        }
        
        .patient-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            border-left-color: var(--primary-color);
        }
        
        .patient-card.active {
            border-left-color: var(--primary-color);
            background: #f0f9ff;
        }
        
        .patient-card.warning {
            border-left-color: var(--warning-color);
            background: #fffbeb;
        }
        
        .patient-card.danger {
            border-left-color: var(--danger-color);
            background: #fef2f2;
        }
        
        .alert-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .alert-badge.critical {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .alert-badge.warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .alert-badge.normal {
            background: #d1fae5;
            color: #065f46;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }
        
        .chart-wrapper {
            position: relative;
            height: 250px;
            width: 100%;
        }
        
        .chart-wrapper canvas {
            max-height: 250px !important;
        }
        
        .device-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .device-status.online {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
            animation: pulse-green 2s infinite;
        }
        
        .device-status.offline {
            background: #6b7280;
        }
        
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 8px rgba(16, 185, 129, 0.6); }
            50% { box-shadow: 0 0 16px rgba(16, 185, 129, 0.8); }
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }
        
        .metric-label {
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .alert-item {
            padding: 1rem;
            border-left: 4px solid;
            margin-bottom: 0.75rem;
            border-radius: 4px;
            background: white;
        }
        
        .alert-item.critical {
            border-left-color: var(--danger-color);
            background: #fef2f2;
        }
        
        .alert-item.warning {
            border-left-color: var(--warning-color);
            background: #fffbeb;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .nav-item {
            padding: 0.75rem 1.5rem;
            color: #4b5563;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: #f3f4f6;
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }
        
        .nav-item.active {
            background: #eff6ff;
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            font-weight: 600;
        }
        
        .vital-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .vital-item:last-child {
            border-bottom: none;
        }
        
        .trend-up {
            color: var(--success-color);
        }
        
        .trend-down {
            color: var(--danger-color);
        }
        
        .search-box {
            position: relative;
            margin: 1rem 1.5rem;
        }
        
        .search-box input {
            width: 100%;
            padding: 0.5rem 0.75rem 0.5rem 2.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
        }
        
        .search-box i {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }
        
        .export-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .export-btn:hover {
            background: #f3f4f6;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- 사이드바 -->
    <div class="sidebar">
        <div class="logo">
            <i class="bi bi-heart-pulse-fill"></i> HealthCare IoT
        </div>
        
        <div class="search-box">
            <i class="bi bi-search"></i>
            <input type="text" id="patientSearch" placeholder="환자 검색..." class="form-control-sm">
        </div>
        
        <div class="nav-item active">
            <i class="bi bi-speedometer2"></i> 대시보드
        </div>
        <div class="nav-item">
            <i class="bi bi-people"></i> 환자 관리
        </div>
        <div class="nav-item">
            <i class="bi bi-graph-up"></i> 통계 분석
        </div>
        <div class="nav-item">
            <i class="bi bi-bell"></i> 알림 설정
        </div>
        <div class="nav-item">
            <i class="bi bi-gear"></i> 설정
        </div>
        
        <div style="padding: 1rem 1.5rem; margin-top: 1rem; border-top: 1px solid #e5e7eb;">
            <h6 class="text-muted mb-3">환자 목록</h6>
            <div id="patientList"></div>
        </div>
    </div>

    <!-- 메인 컨텐츠 -->
    <div class="main-content">
        <!-- 헤더 -->
        <div class="header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-1">실시간 환자 모니터링</h2>
                    <p class="text-muted mb-0">
                        <span id="currentDate"></span> | 
                        총 <span id="totalPatients">8</span>명 |
                        <span class="text-success">정상 <span id="normalCount">5</span></span> |
                        <span class="text-warning">주의 <span id="warningCount">2</span></span> |
                        <span class="text-danger">위험 <span id="criticalCount">1</span></span>
                    </p>
                </div>
                <div>
                    <button class="export-btn me-2">
                        <i class="bi bi-download"></i> 데이터 내보내기
                    </button>
                    <button class="export-btn">
                        <i class="bi bi-funnel"></i> 필터
                    </button>
                </div>
            </div>
        </div>

        <!-- 주요 통계 카드 -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card" style="border-left-color: var(--primary-color);">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="metric-label">활성 디바이스</div>
                            <div class="metric-value text-primary">
                                <span id="activeDevices">8</span>
                            </div>
                            <small class="text-success">
                                <i class="bi bi-arrow-up"></i> 100% 온라인
                            </small>
                        </div>
                        <div class="bg-primary bg-opacity-10 p-3 rounded-circle">
                            <i class="bi bi-smartwatch fs-4 text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card" style="border-left-color: var(--danger-color);">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="metric-label">평균 심박수</div>
                            <div class="metric-value text-danger">
                                <span id="avgHeartRate">72</span> <small class="fs-6">bpm</small>
                            </div>
                            <small class="text-muted">정상 범위</small>
                        </div>
                        <div class="bg-danger bg-opacity-10 p-3 rounded-circle">
                            <i class="bi bi-heart-pulse fs-4 text-danger"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card" style="border-left-color: var(--info-color);">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="metric-label">평균 산소포화도</div>
                            <div class="metric-value text-info">
                                <span id="avgSpO2">97</span> <small class="fs-6">%</small>
                            </div>
                            <small class="text-success">
                                <i class="bi bi-arrow-up"></i> 양호
                            </small>
                        </div>
                        <div class="bg-info bg-opacity-10 p-3 rounded-circle">
                            <i class="bi bi-droplet-fill fs-4 text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card" style="border-left-color: var(--warning-color);">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="metric-label">긴급 알림</div>
                            <div class="metric-value text-warning">
                                <span id="alertCount">3</span>
                            </div>
                            <small class="text-muted">최근 1시간</small>
                        </div>
                        <div class="bg-warning bg-opacity-10 p-3 rounded-circle">
                            <i class="bi bi-exclamation-triangle fs-4 text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 알림 및 차트 -->
        <div class="row">
            <!-- 최근 알림 -->
            <div class="col-xl-4 mb-4">
                <div class="chart-container">
                    <h5 class="mb-3">
                        <i class="bi bi-bell-fill text-warning me-2"></i>최근 알림
                    </h5>
                    <div id="alertsList" style="max-height: 400px; overflow-y: auto;"></div>
                </div>
            </div>

            <!-- 선택된 환자 상세 정보 -->
            <div class="col-xl-8 mb-4">
                <div class="chart-container">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">
                            <i class="bi bi-person-fill text-primary me-2"></i>
                            <span id="selectedPatientName">환자를 선택하세요</span>
                        </h5>
                        <span id="selectedPatientStatus"></span>
                    </div>
                    <div id="selectedPatientVitals"></div>
                </div>
            </div>
        </div>

        <!-- 심박수 차트 -->
        <div class="row">
            <div class="col-xl-6 mb-4">
                <div class="chart-container">
                    <h5 class="mb-3">심박수 (Heart Rate)</h5>
                    <div class="chart-wrapper">
                        <canvas id="heartRateChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-xl-6 mb-4">
                <div class="chart-container">
                    <h5 class="mb-3">산소포화도 (SpO2)</h5>
                    <div class="chart-wrapper">
                        <canvas id="spo2Chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 혈압 및 체온 -->
        <div class="row">
            <div class="col-xl-6 mb-4">
                <div class="chart-container">
                    <h5 class="mb-3">혈압 (Blood Pressure)</h5>
                    <div class="chart-wrapper">
                        <canvas id="bloodPressureChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-xl-6 mb-4">
                <div class="chart-container">
                    <h5 class="mb-3">체온 (Body Temperature)</h5>
                    <div class="chart-wrapper">
                        <canvas id="temperatureChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 활동량 및 수면 -->
        <div class="row">
            <div class="col-xl-6 mb-4">
                <div class="chart-container">
                    <h5 class="mb-3">일일 활동량 (Daily Activity)</h5>
                    <div class="chart-wrapper">
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-xl-6 mb-4">
                <div class="chart-container">
                    <h5 class="mb-3">수면 패턴 (Sleep Pattern)</h5>
                    <div class="chart-wrapper">
                        <canvas id="sleepChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 환자별 비교 테이블 -->
        <div class="chart-container">
            <h5 class="mb-3">환자별 현재 바이탈</h5>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>환자명</th>
                            <th>디바이스</th>
                            <th>심박수</th>
                            <th>SpO2</th>
                            <th>혈압</th>
                            <th>체온</th>
                            <th>걸음수</th>
                            <th>상태</th>
                            <th>마지막 업데이트</th>
                        </tr>
                    </thead>
                    <tbody id="patientTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 환자 데이터
        const patients = [
            { id: 1, name: '김철수', age: 45, device: 'Galaxy Watch 6', status: 'normal', deviceId: 'GW-001' },
            { id: 2, name: '이영희', age: 62, device: 'Apple Watch S9', status: 'warning', deviceId: 'AW-002' },
            { id: 3, name: '박민수', age: 38, device: 'Fitbit Sense 2', status: 'normal', deviceId: 'FB-003' },
            { id: 4, name: '정수진', age: 55, device: 'Galaxy Watch 6', status: 'critical', deviceId: 'GW-004' },
            { id: 5, name: '최동욱', age: 41, device: 'Apple Watch S9', status: 'normal', deviceId: 'AW-005' },
            { id: 6, name: '강서연', age: 59, device: 'Garmin Venu 3', status: 'normal', deviceId: 'GM-006' },
            { id: 7, name: '윤재현', age: 48, device: 'Fitbit Sense 2', status: 'warning', deviceId: 'FB-007' },
            { id: 8, name: '한미라', age: 52, device: 'Galaxy Watch 6', status: 'normal', deviceId: 'GW-008' }
        ];

        let selectedPatientId = 1;
        let charts = {};
        let dataIndex = 0;
        const maxDataPoints = 20;

        // 차트 데이터
        const chartData = {
            labels: [],
            heartRate: [],
            spo2: [],
            systolic: [],
            diastolic: [],
            temperature: [],
            steps: [],
            sleep: []
        };

        // 환자별 바이탈 생성
        function generateVitals(patientId, time) {
            const patient = patients.find(p => p.id === patientId);
            let baseHR = 70;
            let baseSpo2 = 97;
            let baseSystolic = 120;
            let baseDiastolic = 80;
            let baseTemp = 36.5;

            if (patient.status === 'warning') {
                baseHR = 95;
                baseSpo2 = 93;
            } else if (patient.status === 'critical') {
                baseHR = 115;
                baseSpo2 = 88;
                baseSystolic = 150;
                baseTemp = 37.8;
            }

            return {
                heartRate: Math.floor(baseHR + Math.sin(time * 0.1) * 8 + Math.random() * 4),
                spo2: Math.floor(baseSpo2 + Math.random() * 3),
                systolic: Math.floor(baseSystolic + Math.sin(time * 0.05) * 10 + Math.random() * 5),
                diastolic: Math.floor(baseDiastolic + Math.sin(time * 0.05) * 5 + Math.random() * 3),
                temperature: (baseTemp + Math.random() * 0.3).toFixed(1),
                steps: Math.floor(5000 + time * 100 + Math.random() * 500),
                sleepHours: (6 + Math.random() * 2).toFixed(1)
            };
        }

        // 알림 생성
        function generateAlerts() {
            const alerts = [
                { patient: '정수진', type: 'critical', message: '심박수 이상 감지 (115 bpm)', time: '5분 전', icon: 'heart-fill' },
                { patient: '이영희', type: 'warning', message: '산소포화도 감소 (93%)', time: '12분 전', icon: 'droplet-fill' },
                { patient: '윤재현', type: 'warning', message: '혈압 상승 (145/92 mmHg)', time: '25분 전', icon: 'activity' },
                { patient: '정수진', type: 'critical', message: '체온 상승 (37.8°C)', time: '40분 전', icon: 'thermometer-half' }
            ];

            const alertsHtml = alerts.map(alert => `
                <div class="alert-item ${alert.type}">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <strong class="d-block mb-1">
                                <i class="bi bi-${alert.icon} me-1"></i>${alert.patient}
                            </strong>
                            <div class="small">${alert.message}</div>
                        </div>
                        <small class="text-muted">${alert.time}</small>
                    </div>
                </div>
            `).join('');

            document.getElementById('alertsList').innerHTML = alertsHtml;
        }

        // 환자 목록 렌더링
        function renderPatientList() {
            const html = patients.map(patient => `
                <div class="patient-card ${patient.status} ${patient.id === selectedPatientId ? 'active' : ''}" 
                     onclick="selectPatient(${patient.id})">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <strong>${patient.name}</strong>
                        <span class="device-status online"></span>
                    </div>
                    <div class="small text-muted">${patient.age}세 | ${patient.deviceId}</div>
                    <div class="mt-2">
                        <span class="alert-badge ${patient.status === 'critical' ? 'critical' : patient.status === 'warning' ? 'warning' : 'normal'}">
                            ${patient.status === 'critical' ? '위험' : patient.status === 'warning' ? '주의' : '정상'}
                        </span>
                    </div>
                </div>
            `).join('');

            document.getElementById('patientList').innerHTML = html;
        }

        // 환자 선택
        function selectPatient(patientId) {
            selectedPatientId = patientId;
            renderPatientList();
            updateSelectedPatientInfo();
        }

        // 선택된 환자 정보 업데이트
        function updateSelectedPatientInfo() {
            const patient = patients.find(p => p.id === selectedPatientId);
            const vitals = generateVitals(selectedPatientId, dataIndex);

            document.getElementById('selectedPatientName').textContent = 
                `${patient.name} (${patient.age}세) - ${patient.device}`;

            const statusBadge = patient.status === 'critical' 
                ? '<span class="badge bg-danger">위험</span>'
                : patient.status === 'warning'
                ? '<span class="badge bg-warning">주의</span>'
                : '<span class="badge bg-success">정상</span>';

            document.getElementById('selectedPatientStatus').innerHTML = statusBadge;

            const vitalsHtml = `
                <div class="row g-3">
                    <div class="col-md-3 col-6">
                        <div class="p-3 bg-light rounded">
                            <small class="text-muted d-block">심박수</small>
                            <strong class="fs-4 ${vitals.heartRate > 100 ? 'text-danger' : 'text-success'}">
                                ${vitals.heartRate} <small>bpm</small>
                            </strong>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="p-3 bg-light rounded">
                            <small class="text-muted d-block">SpO2</small>
                            <strong class="fs-4 ${vitals.spo2 < 95 ? 'text-danger' : 'text-success'}">
                                ${vitals.spo2} <small>%</small>
                            </strong>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="p-3 bg-light rounded">
                            <small class="text-muted d-block">혈압</small>
                            <strong class="fs-4 ${vitals.systolic > 140 ? 'text-danger' : 'text-success'}">
                                ${vitals.systolic}/${vitals.diastolic}
                            </strong>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="p-3 bg-light rounded">
                            <small class="text-muted d-block">체온</small>
                            <strong class="fs-4 ${vitals.temperature > 37.5 ? 'text-danger' : 'text-success'}">
                                ${vitals.temperature} <small>°C</small>
                            </strong>
                        </div>
                    </div>
                    <div class="col-md-6 col-12">
                        <div class="p-3 bg-light rounded">
                            <small class="text-muted d-block">오늘 걸음수</small>
                            <strong class="fs-4 text-primary">${vitals.steps.toLocaleString()} <small>걸음</small></strong>
                        </div>
                    </div>
                    <div class="col-md-6 col-12">
                        <div class="p-3 bg-light rounded">
                            <small class="text-muted d-block">어제 수면시간</small>
                            <strong class="fs-4 text-info">${vitals.sleepHours} <small>시간</small></strong>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('selectedPatientVitals').innerHTML = vitalsHtml;
        }

        // 환자 테이블 업데이트
        function updatePatientTable() {
            const html = patients.map(patient => {
                const vitals = generateVitals(patient.id, dataIndex);
                const statusClass = patient.status === 'critical' ? 'table-danger' 
                    : patient.status === 'warning' ? 'table-warning' : '';

                return `
                    <tr class="${statusClass}" onclick="selectPatient(${patient.id})" style="cursor: pointer;">
                        <td><strong>${patient.name}</strong></td>
                        <td><small>${patient.device}</small></td>
                        <td><span class="${vitals.heartRate > 100 ? 'text-danger' : ''}">
                            ${vitals.heartRate} bpm</span></td>
                        <td><span class="${vitals.spo2 < 95 ? 'text-danger' : ''}">${vitals.spo2}%</span></td>
                        <td>${vitals.systolic}/${vitals.diastolic}</td>
                        <td>${vitals.temperature}°C</td>
                        <td>${vitals.steps.toLocaleString()}</td>
                        <td>
                            <span class="badge bg-${patient.status === 'critical' ? 'danger' : patient.status === 'warning' ? 'warning' : 'success'}">
                                ${patient.status === 'critical' ? '위험' : patient.status === 'warning' ? '주의' : '정상'}
                            </span>
                        </td>
                        <td><small class="text-muted">방금 전</small></td>
                    </tr>
                `;
            }).join('');

            document.getElementById('patientTableBody').innerHTML = html;
        }

        // 차트 초기화
        function initCharts() {
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 0
                },
                interaction: {
                    mode: 'index',
                    intersect: false
                }
            };

            // 심박수 차트
            charts.heartRate = new Chart(document.getElementById('heartRateChart'), {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: '심박수 (bpm)',
                        data: chartData.heartRate,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 0
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { min: 60, max: 120 }
                    }
                }
            });

            // 산소포화도 차트
            charts.spo2 = new Chart(document.getElementById('spo2Chart'), {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'SpO2 (%)',
                        data: chartData.spo2,
                        borderColor: '#06b6d4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 0
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { min: 85, max: 100 }
                    }
                }
            });

            // 혈압 차트
            charts.bloodPressure = new Chart(document.getElementById('bloodPressureChart'), {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [
                        {
                            label: '수축기 (mmHg)',
                            data: chartData.systolic,
                            borderColor: '#ef4444',
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 0
                        },
                        {
                            label: '이완기 (mmHg)',
                            data: chartData.diastolic,
                            borderColor: '#3b82f6',
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        y: { min: 60, max: 160 }
                    }
                }
            });

            // 체온 차트
            charts.temperature = new Chart(document.getElementById('temperatureChart'), {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: '체온 (°C)',
                        data: chartData.temperature,
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 0
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { min: 35, max: 39 }
                    }
                }
            });

            // 활동량 차트
            charts.activity = new Chart(document.getElementById('activityChart'), {
                type: 'bar',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: '걸음수',
                        data: chartData.steps,
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // 수면 패턴 차트
            charts.sleep = new Chart(document.getElementById('sleepChart'), {
                type: 'bar',
                data: {
                    labels: ['월', '화', '수', '목', '금', '토', '일'],
                    datasets: [{
                        label: '수면 시간',
                        data: [7.2, 6.8, 7.5, 6.5, 7.0, 8.2, 8.5],
                        backgroundColor: '#8b5cf6'
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        y: { min: 0, max: 10 }
                    }
                }
            });
        }

        // 데이터 업데이트
        function updateData() {
            const time = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            const vitals = generateVitals(selectedPatientId, dataIndex);

            chartData.labels.push(time);
            chartData.heartRate.push(vitals.heartRate);
            chartData.spo2.push(vitals.spo2);
            chartData.systolic.push(vitals.systolic);
            chartData.diastolic.push(vitals.diastolic);
            chartData.temperature.push(parseFloat(vitals.temperature));
            chartData.steps.push(vitals.steps);

            if (chartData.labels.length > maxDataPoints) {
                chartData.labels.shift();
                chartData.heartRate.shift();
                chartData.spo2.shift();
                chartData.systolic.shift();
                chartData.diastolic.shift();
                chartData.temperature.shift();
                chartData.steps.shift();
            }

            // 차트 업데이트
            Object.keys(charts).forEach(key => {
                if (charts[key] && typeof charts[key].update === 'function') {
                    charts[key].update('none');
                }
            });

            // 통계 업데이트
            const avgHR = Math.round(chartData.heartRate.reduce((a, b) => a + b, 0) / chartData.heartRate.length);
            const avgSpO2 = Math.round(chartData.spo2.reduce((a, b) => a + b, 0) / chartData.spo2.length);

            document.getElementById('avgHeartRate').textContent = avgHR;
            document.getElementById('avgSpO2').textContent = avgSpO2;

            updateSelectedPatientInfo();
            updatePatientTable();

            dataIndex++;
        }

        // 초기화
        window.addEventListener('load', function() {
            // 날짜 표시
            const today = new Date();
            document.getElementById('currentDate').textContent = 
                today.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });

            // 초기 데이터 생성
            for (let i = 0; i < maxDataPoints; i++) {
                const time = new Date(Date.now() - (maxDataPoints - i) * 3000).toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                const vitals = generateVitals(selectedPatientId, i);

                chartData.labels.push(time);
                chartData.heartRate.push(vitals.heartRate);
                chartData.spo2.push(vitals.spo2);
                chartData.systolic.push(vitals.systolic);
                chartData.diastolic.push(vitals.diastolic);
                chartData.temperature.push(parseFloat(vitals.temperature));
                chartData.steps.push(vitals.steps);
            }

            dataIndex = maxDataPoints;

            initCharts();
            renderPatientList();
            generateAlerts();
            updateSelectedPatientInfo();
            updatePatientTable();

            // 3초마다 업데이트
            setInterval(updateData, 3000);
        });

        // 검색 기능
        document.getElementById('patientSearch').addEventListener('input', function(e) {
            const search = e.target.value.toLowerCase();
            const cards = document.querySelectorAll('.patient-card');
            
            cards.forEach(card => {
                const name = card.querySelector('strong').textContent.toLowerCase();
                card.style.display = name.includes(search) ? 'block' : 'none';
            });
        });
    </script>
</body>
</html>